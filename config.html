<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<p>
;;; ; Insert the following line in your local .emacs file:
;;;
;;; (load "~/Dropbox/init/emacs/init.el")
;;; (load "~/Dropbox/init/emacs/skeletons.el")
;;;
</p>

<p>
(add-to-list 'load-path "~/Dropbox/init/emacs/emacs.d/lisp/")
</p>

<p>
(require 'package)
(setq package-archives '(("melpa" . "<a href="https://melpa.org/packages/">https://melpa.org/packages/</a>")
			  ("gnu" . "<a href="https://elpa.gnu.org/packages/">https://elpa.gnu.org/packages/</a>")))
(package-initialize)
</p>

<p>
(require 'use-package)
</p>

<p>
(defun display-startup-time ()
    ( message " Emacs loaded in %s with %d garbage collections."
              ( format "%.2f seconds"
                       (float-time
                        (time-subtract after-init-time before-init-time)))
              gcs-done))
  (add-hook 'emacs-startup-hook #'display-startup-time)
</p>

<p>
(setq use-package-verbose t)
</p>

<p>
(use-package flyspell
  :custom
  (ispell-program-name "aspell")
  ;; Default dictionary. To change do M-x ispell-change-dictionary RET.
  (aspell-dictionary "de<sub>DE</sub>")
  (aspell-program-name "/usr/bin/aspell")
  (ispell-dictionary "en<sub>US</sub>")
  (ispell-program-name "/usr/bin/aspell")
  :config
  (define-key flyspell-mode-map [down-mouse-3] 'flyspell-correct-word)
  (add-hook 'org-mode-hook 'flyspell-mode)
  (add-hook 'TeX-mode-hook 'flyspell-mode)
  (add-hook 'emacs-lisp-mode-hook 'flyspell-prog-mode))
</p>

<p>
(setq completion-styles '(basic initials partial-completion substring flex))
</p>

<p>
(global-hl-line-mode 1)                   ; highlight line
(set-face-background 'hl-line "#999999")
(tool-bar-mode -1) ; turn off tool-bar
(menu-bar-mode -1) ; turn off menu-bar
(normal-erase-is-backspace-mode 1)
(setq inhibit-startup-message t)
(setq inhibit-startup-screen  t)
(setq initial-scratch-message "")
(setq line-number-mode t)
(setq column-number-mode t)
(fset 'yes-or-no-p 'y-or-n-p) ; simplify interactive dialogue
(setq show-paren-delay 0)
(show-paren-mode t) ; parentheses highlighting
(add-to-list 'default-frame-alist '(fullscreen . maximized))
(set-face-attribute 'default nil :height 140) ; change font size
</p>

<p>
(setq scroll-margin 3
scroll-conservatively 10000)
</p>

<p>
;; visual-fill-column
(require 'visual-fill-column)
(use-package visual-fill-column)
(setq-default fill-column 100)
</p>

<p>
;; line wrapping
(global-visual-line-mode 1)
</p>

<p>
(setq make-backup-files nil)
</p>

<p>
;; google this mode  C-c / &lt;enter&gt;   or  C-c / SPC (google this region)
(require 'google-this)
(use-package google-this
  :config
  (google-this-mode 1))
</p>

<p>
(use-package magit  :ensure t)
</p>

<p>
(use-package simple-httpd
:ensure t)
</p>

<p>
(defun org-mode-setup ()
  (org-indent-mode)
  (visual-line-mode)
  (auto-fill-mode)
  ;;(visual-fill-column-mode) ;; problems in combination with org-indent-mode
  )
</p>

<p>
(use-package org :pin gnu )
(use-package org-mode
  :hook (org-mode . org-mode-setup))
</p>

<p>
(setq initial-major-mode 'org-mode)
(setq default-major-mode 'org-mode)
(setq org-todo-keywords
      '((sequence "TODO(t)" "NEXT(n)" "WAIT" "|" "DONE(d)" "CANCELED(c)")))
(eval-after-load "org"
  '(progn
     (if (assoc "\\.ods\\'" org-file-apps)
         (setcdr (assoc "\\.ods\\'" org-file-apps) "loffice %s")
       (add-to-list 'org-file-apps '("\\.ods\\'" . "loffice %s") t))
     (if (assoc "\\.png\\'" org-file-apps)
         (setcdr (assoc "\\.png\\'" org-file-apps) "ristretto %s")
       (add-to-list 'org-file-apps '("\\.png\\'" . "ristretto %s") t))
     (if (assoc "\\.gif\\'" org-file-apps)
         (setcdr (assoc "\\.gif\\'" org-file-apps) "ristretto %s")
       (add-to-list 'org-file-apps '("\\.gif\\'" . "ristretto %s") t))
     ;; Change .pdf association directly within the alist
     (setcdr (assoc "\\.pdf\\'" org-file-apps) "evince %s")))
(add-hook 'org-mode-hook
          (lambda( )
            )
          )
</p>

<p>
(use-package org-roam
      :ensure t
      :init
      (setq org-roam-v2-ack t)
      :custom
      (org-roam-directory "~/Dropbox/org/roam")
      (org-roam-dailies-directory "journal/")
    (org-roam-completion-everywhere t)
      :bind (("C-c n l" . org-roam-buffer-toggle)
             ("C-c n f" . org-roam-node-find)
             ("C-c n i" . org-roam-node-insert)
           :map org-mode-map
         ("C-M-j" . completion-at-point)
       :map org-roam-dailies-map
     ("Y" . org-roam-dailies-capture-yesterday)
  ("T" . org-roam-dailies-capture-tomorrow)
     )
    :bind-keymap
  ("C-c n d" . org-roam-dailies-map)
      :config
    (require 'org-roam-dailies)
  (org-roam-db-autosync-mode)
      (org-roam-setup))
</p>

<p>
(use-package org-roam-ui
    :after org-roam
;;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
;;         a hookable mode anymore, you're advised to pick something yourself
;;         if you don't care about startup time, use
;;  :hook (after-init . org-roam-ui-mode)
    :config
    (setq org-roam-ui-sync-theme t
          org-roam-ui-follow t
          org-roam-ui-update-on-save t
          org-roam-ui-open-on-start t))
</p>

<p>
(setq org-clock-sound "~/Dropbox/audio/oriental<sub>gong.wav</sub>")
</p>

<p>
;;    (setq-default org-display-custom-times t)
;;    (setq org-time-stamp-custom-formats '("&lt;%Y-%m-%d %H:%M&gt;" . "&lt;%H:%M&gt;"))
  (defun now (a)
    "Insert string for the current time formatted like '2:34 PM' or 1507121460"
    (interactive)
    (setq minute (string-to-number (format-time-string "%02M") 10))
    (setq remainder (mod  minute 3))
    (setq current<sub>time</sub> (concat (format-time-string "%02H") ":" (format "%02d" (- minute remainder))))
</p>

<p>
  (insert (concat current<sub>time</sub> " " a "\n" current<sub>time</sub> " - "))
;;        (insert (format-time-string "%02H:%02M"))
  )
</p>

<p>
;;   (require 'org-bullets)
;;   (use-package org-bullets
;;                :hook (org-mode . org-bullets-mode)
;;                :custom
;;                (org-bullets-bullet-list '("◉" "○" "●" "○" "●" "○" "●"))
;;                )
;;
;; ;; org heading non monospace headings
;; (dolist (face '((org-level-1 . 1.2)
;; 		(org-level-2 . 1.1)
;; 		(org-level-3 . 1.05)
;; 		(org-level-4 . 1.0)
;; 		(org-level-5 . 1.1)
;; 		(org-level-6 . 1.1)
;; 		(org-level-7 . 1.1)
;; 		(org-level-8 . 1.1)))
;;   (set-face-attribute (car face) nil :font "Cantarell" :weight 'regular :height (cdr face)))
</p>

<p>
(setq image-file-name-extensions
   (quote
    ("png" "jpeg" "jpg" "gif" "tiff" "tif" "xbm" "xpm" "pbm" "pgm" "ppm" "pnm" "svg" "pdf" "bmp")))
</p>

<p>
(setq org-image-actual-width 800)
</p>

<p>
(setq org-imagemagick-display-command "convert -density 800 \"%s\" -thumbnail \"%sx%s&gt;\" \"%s\"")
(defun org-display-inline-images (&amp;optional include-linked refresh beg end)
  "Display inline images.
Normally only links without a description part are inlined, because this
is how it will work for export.  When INCLUDE-LINKED is set, also links
with a description part will be inlined.  This
can be nice for a quick
look at those images, but it does not reflect what exported files will look
like.
When REFRESH is set, refresh existing images between BEG and END.
This will create new image displays only if necessary.
BEG and END default to the buffer boundaries."
  (interactive "P")
  (unless refresh
    (org-remove-inline-images)
    (if (fboundp 'clear-image-cache) (clear-image-cache)))
  (save-excursion
    (save-restriction
      (widen)
      (setq beg (or beg (point-min)) end (or end (point-max)))
      (goto-char beg)
      (let ((re (concat "\\[\\[\\(\\(file:\\)\\|\\([./~]\\)\\)\\([^]\n]+?"
                        (substring (org-image-file-name-regexp) 0 -2)
                        "\\)\\]" (if include-linked "" "\\]")))
            old file ov img)
        (while (re-search-forward re end t)
          (setq old (get-char-property-and-overlay (match-beginning 1)
                                                   'org-image-overlay)
        file (expand-file-name
                      (concat (or (match-string 3) "") (match-string 4))))
          (when (file-exists-p file)
            (let ((file-thumb (format "%s%s<sub>thumb.png</sub>" (file-name-directory file) (file-name-base file))))
              (if (file-exists-p file-thumb)
                  (let ((thumb-time (nth 5 (file-attributes file-thumb 'string)))
                        (file-time (nth 5 (file-attributes file 'string))))
                    (if (time-less-p thumb-time file-time)
            (shell-command (format org-imagemagick-display-command
                           file org-image-actual-width org-image-actual-width file-thumb) nil nil)))
                (shell-command (format org-imagemagick-display-command
                                         file org-image-actual-width org-image-actual-width file-thumb) nil nil))
              (if (and (car-safe old) refresh)
                  (image-refresh (overlay-get (cdr old) 'display))
                (setq img (save-match-data (create-image file-thumb)))
                (when img
                  (setq ov (make-overlay (match-beginning 0) (match-end 0)))
                  (overlay-put ov 'display img)
                  (overlay-put ov 'face 'default)
                  (overlay-put ov 'org-image-overlay t)
                  (overlay-put ov 'modification-hooks
                               (list 'org-display-inline-remove-overlay))
                  (push ov org-inline-image-overlays))))))))))
</p>

<p>
(use-package hide-mode-line)
(defun presentation-setup ()
  (hide-mode-line-mode 1)
  (org-display-inline-images))
</p>

<p>
(defun presentation-end ()
  (hide-mode-line-mode 0))
</p>

<p>
(use-package org-tree-slide
  :hook ((org-tree-slide-play . presentation-setup)
         (org-tree-slide-stop . presentation-end))
  :custom
  (org-tree-slide-slide-in-effect t)
  (org-tree-slide-activate-message "Presentation started")
  (org-tree-slide-deactivate-message "Presentation finished")
  (org-tree-slide-header t)
  (org-tree-slide-breadcrumbs " // ")
  (org-image-actual-width nil))
(global-set-key "\C-cp" 'org-tree-slide-mode)
</p>

<p>
(global-set-key (kbd "C-c l") 'org-store-link)
(global-set-key (kbd "C-c a") 'org-agenda)
(global-set-key (kbd "C-c c") 'org-capture)
(global-set-key (kbd "C-c r") 'org-refile)
</p>

<p>
(setq org-confirm-babel-evaluate nil)
</p>

<p>
(org-babel-do-load-languages
 'org-babel-load-languages
 '(
   (shell . t)
   (python . t)
   ))
(setq org-src-fontify-natively t)
</p>

<p>
(require 'org-tempo) ; enable &lt;s expansion for generic source code block
(add-to-list 'org-structure-template-alist '("sh" . "src shell"))
(add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
(add-to-list 'org-structure-template-alist '("py" . "src python"))
(add-to-list 'org-structure-template-alist '("gp" . "src gnuplot"))
</p>

<p>
(setq org-directory "~/org/")
              (setq org-agenda-files
                        '(
                      "~/Dropbox/org/projects.org"
                    "~/Dropbox/org/habits.org"
                  "~/Dropbox/org/birthdays.org"
                "~/Dropbox/org/inbox.org"
              "~/Dropbox/org/tickler.org"
            "~/mnt/nas/Intenso-SpeedLine-00/org/work.org"
                          ))
</p>

<p>
                (setq org-habit-show-habits-only-for-today nil)
                (setq org-agenda-start-on-weekday nil)
                (setq org-agenda-custom-commands
                      '(
                        ("d" "Daily agenda and High-prio projects"
                         (
                          (tags "PRIORITY=\"A\""
                                ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
                                 (org-agenda-overriding-header "High-priority unfinished projects:")))
                          (agenda ""     ((org-agenda-span 'day)) )
;;                          (alltodo ""
;;                                   ((org-agenda-skip-function '(or (air-org-skip-subtree-if-habit)
;;                                                                   (air-org-skip-subtree-if-priority ?A)
;;                                                                   (org-agenda-skip-if nil '(scheduled deadline))))
;;                                    (org-agenda-overriding-header "ALL normal priority tasks:")))
</p>


<p>
 )
((org-agenda-compact-blocks t))
)
</p>

<p>
		   ("w" "Next 3 days"
(
</p>

<p>
(tags "PRIORITY=\"A\""
      ((org-agenda-skip-function '(org-agenda-skip-entry-if 'todo 'done))
       (org-agenda-overriding-header "High-priority unfinished projects:")))
( agenda ""     ((org-agenda-span 3)) )
</p>

<p>
 )
)
</p>



<p>
("n" "Next Tasks"
 (
  (todo "NEXT" ((org-agenda-overriding-header "Next Actions")))
  )
 )
</p>


<p>
("C" "Tasks by context"
 (
  (tags "@work|@learn"
 ((org-agenda-overriding-header "WorkLearn")
  (org-agenda-skip-function #'my-org-agenda-skip-all-siblings-but-first)))
  (tags "@hobby|@relax|@sport"
 ((org-agenda-overriding-header "HobbyRelaxSport")
  (org-agenda-skip-function #'my-org-agenda-skip-all-siblings-but-first)))
  (tags "@coding"
 ((org-agenda-overriding-header "Coding")
  (org-agenda-skip-function #'my-org-agenda-skip-all-siblings-but-first)
  ))
  )                           )
</p>

<p>
  )
)
</p>



<p>
(defun air-org-skip-subtree-if-priority (priority)
  "Skip an agenda subtree if it has a priority of PRIORITY.
</p>

<p>
PRIORITY may be one of the characters ?A, ?B, or ?C."
  (let ((subtree-end (save-excursion (org-end-of-subtree t)))
	(pri-value (* 1000 (- org-lowest-priority priority)))
	(pri-current (org-get-priority (thing-at-point 'line t))))
    (if (= pri-value pri-current)
	subtree-end
      nil)))
</p>

<p>
(defun air-org-skip-subtree-if-habit ()
  "Skip an agenda entry if it has a STYLE property equal to \"habit\"."
  (let ((subtree-end (save-excursion (org-end-of-subtree t))))
    (if (string= (org-entry-get nil "STYLE") "habit")
	subtree-end
      nil)))
</p>


<p>
(defun my-org-agenda-skip-all-siblings-but-first ()
    "Skip all but the first non-done entry."
    (let (should-skip-entry)
      (unless (org-current-is-todo)
	(setq should-skip-entry t))
      (save-excursion
	(while (and (not should-skip-entry) (org-goto-sibling t))
	  (when (org-current-is-todo)
	    (setq should-skip-entry t))))
      (when should-skip-entry
	(or (outline-next-heading)
	    (goto-char (point-max))))))
</p>

<p>
(defun org-current-is-todo ()
    (or (string= "TODO" (org-get-todo-state)) (string= "NEXT" (org-get-todo-state)))
</p>

<p>
)
</p>

<p>
;; Refiling tasks
(setq org-refile-targets '(("~/Dropbox/org/projects.org" :maxlevel . 3)
                           ("~/Dropbox/org/archive.org" :maxlevel . 3)
                           ("~/Dropbox/org/someday.org" :maxlevel . 3)
                           ("~/Dropbox/org/habits.org" :maxlevel . 3)
                           ("~/Dropbox/org/tickler.org" :maxlevel . 2)))
</p>


<p>
(advice-add 'org-refile :after 'org-save-all-org-buffers) ;autosave
</p>


<p>
;; Capture templates
(setq org-capture-templates '(("t" "Todo [inbox]" entry
                               (file+headline "~/Dropbox/org/inbox.org" "Tasks")
                               "* TODO %i%?")
                              ("T" "Tickler" entry
                               (file+headline "~/Dropbox/org/tickler.org" "Tickler")
                               "* %i%? \n %U")))
</p>

<p>
(require 'org-habit)
(add-to-list 'org-modules 'org-habit)
(setq org-habit-graph-column 60)
</p>

<p>
(use-package marginalia
  :ensure t
  :config
  (marginalia-mode))
</p>

<p>
(use-package embark
  :ensure t
</p>

<p>
  :bind
  (("C-." . embark-act)         ;; pick some comfortable binding
   ("C-;" . embark-dwim)        ;; good alternative: M-.
   ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'
)
</p>

<p>
;; compile tex documents to pdf
(setq TeX-PDF-mode t)
</p>

<p>
; increase size of latex images
(require 'org)
(setq org-format-latex-options (plist-put org-format-latex-options :scale 1.5))
</p>

<p>
;; before saving
(add-hook 'before-save-hook
  (lambda ()
    ;; remove unnecessary whitespace
    (delete-trailing-whitespace)
  )
)
</p>

<p>
;; after saving
(add-hook 'after-save-hook
  (lambda ()
    ;; auto chmod +x if first line starts with `#!':
    (executable-make-buffer-file-executable-if-script-p)
  )
)
</p>

<p>
(add-hook 'awk-mode-hook
  (lambda ()
    (setq comment-start "#")
    (setq indent-tabs-mode nil)
    (setq c-default-style "bsd")
    (setq c-basic-offset 2)
  )
)
</p>

<p>
(setq auto-mode-alist
  (nconc
   '( ("\\.F90\(" . f90-mode) ("\\.fp\)"  . fortran-mode) )
   auto-mode-alist
  )
)
</p>

<p>
(add-hook 'makefile-mode-hook
  (lambda ()
    (setq indent-tabs-mode t)
  )
)
</p>

<p>
(autoload 'gnuplot-mode "gnuplot" "gnuplot major mode" t)
(setq auto-mode-alist (append '(("\\.gp\(" . gnuplot-mode)) auto-mode-alist))
(setq auto-mode-alist (append '(("\\.gnu\)" . gnuplot-mode)) auto-mode-alist))
</p>

<p>
(add-hook 'gnuplot-mode-hook
   (lambda ()
	    (setq indent-tabs-mode nil)
    (setq comment-start "#")
    (setq indent-tabs-mode t)
  )
)
</p>

<p>
(add-hook 'emacs-lisp-mode-hook
  (lambda ()
    (setq indent-tabs-mode nil)
    (setq comment-start ";")
  )
)
</p>

<p>
(add-hook 'python-mode-hook
  (lambda ()
    (setq indent-tabs-mode nil)
    (setq comment-start "#")
  )
)
</p>

<p>
(add-hook 'sh-mode-hook
  (lambda ()
    (setq indent-tabs-mode nil)
    (setq comment-start "#")
    (setq indent-tabs-mode nil)
    (setq sh-basic-offset 2)
  )
)
</p>

<p>
(add-hook 'text-mode-hook
  (lambda ()
    (auto-fill-mode t)
    (setq default-justification 'left)
    (if (not (char-or-string-p comment-start))
      (setq comment-start "")
    )
  )
)
</p>

<p>
(add-hook 'LaTeX-mode-hook 'reftex-mode)
</p>

<p>
;; Company mode
(setq company-idle-delay 0)
(setq company-minimum-prefix-length 1)
</p>

<p>
;; Go - lsp-mode
;; Set up before-save hooks to format buffer and add/delete imports.
(defun lsp-go-install-save-hooks ()
  (add-hook 'before-save-hook #'lsp-format-buffer t t)
  (add-hook 'before-save-hook #'lsp-organize-imports t t))
(add-hook 'go-mode-hook #'lsp-go-install-save-hooks)
</p>

<p>
;; Start LSP Mode and YASnippet mode
(add-hook 'go-mode-hook #'lsp-deferred)
(add-hook 'go-mode-hook #'yas-minor-mode)
</p>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)</p>
</div>
</body>
</html>
